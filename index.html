<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Stock Watchlist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            /* Prevent pull-to-refresh and other gestures on the body */
            overscroll-behavior-y: contain;
        }
        .canvas-container {
            width: 100%;
            height: 75vh;
            border-radius: 0.75rem;
            overflow: hidden;
            background-color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            cursor: pointer;
            /* For touch interactions on the canvas */
            touch-action: none;
        }
    </style>
</head>
<body class="p-2 sm:p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-6">
            <h1 class="text-3xl font-bold text-gray-800 flex items-center justify-center">
                <svg class="w-8 h-8 mr-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                Stock Watchlist
            </h1>
        </header>

        <div id="last-updated-container" class="text-center text-sm text-gray-500 mb-4"></div>

        <div class="mb-4">
            <input type="text" id="searchInput" placeholder="Search by stock symbol or name..." class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
        </div>

        <div class="canvas-container">
            <canvas id="stockCanvas"></canvas>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const canvas = document.getElementById('stockCanvas');
        const ctx = canvas.getContext('2d');
        const searchInput = document.getElementById('searchInput');
        const lastUpdatedContainer = document.getElementById('last-updated-container');

        // Data is now sourced from the provided CSV file content.
        let stocks = [
            { symbol: 'ABEO', name: 'Abeona Therapeutics Inc.', price: 5.44, change: 0.08, changePercent: '1.49%' },
            { symbol: 'ABVX', name: 'Abivax SA', price: 82.84, change: 0.84, changePercent: '1.02%' },
            { symbol: 'ACAD', name: 'ACADIA Pharmaceuticals Inc.', price: 21.05, change: -0.16, changePercent: '-0.75%' },
            { symbol: 'ACB', name: 'Aurora Cannabis Inc.', price: 4.86, change: -0.09, changePercent: '-1.82%' },
            { symbol: 'ACHR', name: 'Archer Aviation Inc.', price: 9.28, change: -0.05, changePercent: '-0.54%' },
            { symbol: 'ACLX', name: 'Arcellx Inc.', price: 79.75, change: 1.34, changePercent: '1.72%' },
            { symbol: 'ADAP', name: 'Adaptimmune Therapeutics plc', price: 0.147, change: 0.02, changePercent: '15.75%' },
            { symbol: 'ADV', name: 'Advantage Solutions Inc.', price: 1.56, change: -0.05, changePercent: '-3.11%' },
            { symbol: 'AGAE', name: 'Allied Gaming & Entertainment Inc.', price: 0.9503, change: 0.0262, changePercent: '2.84%' },
            { symbol: 'AGEN', name: 'Agenus Inc.', price: 3.95, change: 0.05, changePercent: '1.28%' },
            { symbol: 'AGL', name: 'agilon health inc.', price: 1.09, change: 0.00, changePercent: '0.00%' },
            { symbol: 'AGNC', name: 'AGNC Investment Corp.', price: 9.84, change: 0.08, changePercent: '0.82%' },
            { symbol: 'AI', name: 'C3.ai Inc.', price: 17.14, change: -0.14, changePercent: '-0.81%' },
            { symbol: 'AIFF', name: 'Firefly Neuroscience Inc.', price: 2.86, change: -0.03, changePercent: '-1.04%' },
            { symbol: 'AKO.B', name: 'Embotelladora Andina SA ADR Series B', price: 21.1, change: 0.07, changePercent: '0.33%' },
            { symbol: 'ALAB', name: 'Astera Labs Inc.', price: 80.5, change: -0.52, changePercent: '-0.64%' },
            { symbol: 'AMC', name: 'AMC Entertainment Holdings Inc.', price: 2.8, change: -0.01, changePercent: '-0.36%' },
            { symbol: 'AMLX', name: 'Amylyx Pharmaceuticals Inc.', price: 2.74, change: 0.1, changePercent: '3.79%' },
            { symbol: 'AMPL', name: 'Amplitude Inc.', price: 7.77, change: -0.11, changePercent: '-1.39%' },
            { symbol: 'AMRN', name: 'Amarin Corporation plc', price: 0.77, change: 0.02, changePercent: '2.11%' },
            { symbol: 'AMRX', name: 'Amneal Pharmaceuticals Inc.', price: 4.89, change: 0.02, changePercent: '0.41%' },
            { symbol: 'ANTX', name: 'Agenus Inc.', price: 3.95, change: 0.05, changePercent: '1.28%' },
            { symbol: 'APPS', name: 'Digital Turbine Inc.', price: 1.81, change: 0.01, changePercent: '0.56%' },
            { symbol: 'ARM', name: 'Arm Holdings plc', price: 161.4, change: 1.13, changePercent: '0.70%' },
            { symbol: 'ARQQ', name: 'Arqit Quantum Inc.', price: 0.35, change: 0.01, changePercent: '4.03%' },
            { symbol: 'ARR', name: 'ARMOUR Residential REIT Inc.', price: 19.34, change: 0.16, changePercent: '0.83%' },
            { symbol: 'ARTL', name: 'Artelo Biosciences Inc.', price: 1.25, change: 0.05, changePercent: '4.17%' },
            { symbol: 'ARVN', name: 'Arvinas Inc.', price: 23.35, change: 0.28, changePercent: '1.21%' },
            { symbol: 'ASAN', name: 'Asana Inc.', price: 13.06, change: 0.05, changePercent: '0.38%' },
            { symbol: 'ASST', name: 'Asset Entities Inc.', price: 0.44, change: 0, changePercent: '0.00%' },
            { symbol: 'ATAT', name: 'Atour Lifestyle Holdings Ltd.', price: 15.65, change: 0.04, changePercent: '0.26%' },
            { symbol: 'ATCH', name: 'Abtech Holdings Inc.', price: 0.03, change: 0, changePercent: '0.00%' },
            { symbol: 'ATHE', name: 'Alterity Therapeutics Ltd.', price: 2.1, change: -0.03, changePercent: '-1.41%' },
            { symbol: 'AUPH', name: 'Aurinia Pharmaceuticals Inc.', price: 5.75, change: 0.07, changePercent: '1.23%' },
            { symbol: 'AUR', name: 'Authentic Holdings Inc.', price: 1.9, change: -0.04, changePercent: '-2.06%' },
            { symbol: 'AVIR', name: 'Aviragen Therapeutics Inc. (Delisted)', price: '--', change: '--', changePercent: '--' },
            { symbol: 'AVXL', name: 'Anavex Life Sciences Corp.', price: 3.2, change: 0.1, changePercent: '3.23%' },
            { symbol: 'AYRWF', name: 'Ayr Wellness Inc.', price: 2.45, change: -0.03, changePercent: '-1.21%' },
            { symbol: 'BAND', name: 'Bandwidth Inc.', price: 15.68, change: 0.28, changePercent: '1.82%' },
            { symbol: 'BCAX', name: 'BCA Acquisition Corp.', price: 11.01, change: 0, changePercent: '0.00%' },
            { symbol: 'BCS', name: 'Barclays PLC', price: 10.97, change: 0.05, changePercent: '0.46%' },
            { symbol: 'BCTCF', name: 'BCB Bancorp Inc.', price: 10.15, change: 0, changePercent: '0.00%' },
            { symbol: 'BDRX', name: 'Biodexa Pharmaceuticals PLC', price: 1.14, change: 0.02, changePercent: '1.79%' },
            { symbol: 'BGMS', name: 'Bio-Gene Technology Ltd.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'BHC', name: 'Bausch Health Companies Inc.', price: 6.84, change: -0.05, changePercent: '-0.73%' },
            { symbol: 'BIOA', name: 'BioAfrica Holdings Ltd.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'BKYI', name: 'BIO-key International Inc.', price: 0.44, change: 0.01, changePercent: '1.40%' },
            { symbol: 'BLBX', name: 'Blueberry Therapeutics Inc.', price: 0.45, change: -0.01, changePercent: '-2.17%' },
            { symbol: 'BMBL', name: 'Bumble Inc.', price: 11.2, change: 0.03, changePercent: '0.27%' },
            { symbol: 'BNXAF', name: 'Bionexus Gene Solutions Corp.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'BNZI', name: 'Banza Inc.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'BOF', name: 'BranchOut Food Inc.', price: 1.34, change: -0.02, changePercent: '-1.47%' },
            { symbol: 'BPMC', name: 'Bristol-Myers Squibb Co.', price: 42.14, change: 0.16, changePercent: '0.38%' },
            { symbol: 'BRPHF', name: 'Breville Group Ltd.', price: 14.28, change: 0, changePercent: '0.00%' },
            { symbol: 'BRR', name: 'Broadridge Financial Solutions Inc.', price: 204.3, change: 0.58, changePercent: '0.28%' },
            { symbol: 'BRT', name: 'BRT Apartments Corp.', price: 16.63, change: 0.01, changePercent: '0.06%' },
            { symbol: 'BRY', name: 'Berry Corporation', price: 7.74, change: 0.12, changePercent: '1.58%' },
            { symbol: 'BUD', name: 'Anheuser-Busch InBev SA/NV', price: 61.42, change: 0.28, changePercent: '0.46%' },
            { symbol: 'CAG', name: 'Conagra Brands Inc.', price: 29.58, change: 0.03, changePercent: '0.10%' },
            { symbol: 'CAKE', name: 'Cheesecake Factory Inc.', price: 31.02, change: 0.2, changePercent: '0.65%' },
            { symbol: 'CELH', name: 'Celsius Holdings Inc.', price: 61.34, change: 0.69, changePercent: '1.14%' },
            { symbol: 'CEP', name: 'Cantor Equity Partners Inc.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'CGC', name: 'Canopy Growth Corporation', price: 7.08, change: -0.2, changePercent: '-2.75%' },
            { symbol: 'CLBR', name: 'Colombier Acquisition Corp.', price: 10.66, change: -0.01, changePercent: '-0.09%' },
            { symbol: 'CLM', name: 'Colonial High Income Municipal Trust', price: 7.21, change: 0.01, changePercent: '0.14%' },
            { symbol: 'CLSK', name: 'Cleanspark Inc.', price: 16.5, change: 0.13, changePercent: '0.79%' },
            { symbol: 'CMG', name: 'Chipotle Mexican Grill Inc.', price: 3200.76, change: -5.7, changePercent: '-0.18%' },
            { symbol: 'CMPS', name: 'Compass Pathways plc', price: 6.9, change: 0.11, changePercent: '1.62%' },
            { symbol: 'CMTL', name: 'Comtech Telecommunications Corp.', price: 3.33, change: 0.05, changePercent: '1.52%' },
            { symbol: 'CNBS', name: 'VictoryShares Cannabis ETF', price: 7.91, change: -0.09, changePercent: '-1.12%' },
            { symbol: 'COEP', name: 'Coeptis Therapeutics Inc.', price: 0.61, change: 0.01, changePercent: '1.33%' },
            { symbol: 'COUR', name: 'Coursera Inc.', price: 12.39, change: 0.19, changePercent: '1.56%' },
            { symbol: 'CPB', name: 'Campbell Soup Company', price: 43.15, change: -0.11, changePercent: '-0.25%' },
            { symbol: 'CPIX', name: 'Citizen\'s Community Bancorp', price: 13.9, change: -0.1, changePercent: '-0.71%' },
            { symbol: 'CRBU', name: 'Caribou Biosciences Inc.', price: 4.88, change: 0.16, changePercent: '3.39%' },
            { symbol: 'CRGY', name: 'Crescent Energy Company', price: 11.5, change: 0.12, changePercent: '1.05%' },
            { symbol: 'CRON', name: 'Cronos Group Inc.', price: 2.51, change: -0.01, changePercent: '-0.40%' },
            { symbol: 'CRSP', name: 'CRISPR Therapeutics AG', price: 57.1, change: 1.05, changePercent: '1.87%' },
            { symbol: 'CRVS', name: 'Corrus Pharmaceuticals Holdings Inc.', price: 0.22, change: 0.01, changePercent: '2.56%' },
            { symbol: 'CSTL', name: 'Castle Biosciences Inc.', price: 19.33, change: 0.38, changePercent: '2.01%' },
            { symbol: 'CTRN', name: 'Citi Trends, Inc.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'CURLF', name: 'Curlato Holdings Inc.', price: 2.55, change: -0.04, changePercent: '-1.54%' },
            { symbol: 'CXDO', name: 'CXApp Inc.', price: 0.12, change: 0, changePercent: '0.00%' },
            { symbol: 'CYTK', name: 'Cytokinetics Inc.', price: 51.58, change: 0.62, changePercent: '1.22%' },
            { symbol: 'DARE', name: 'Sharecare Inc.', price: 0.44, change: 0.02, changePercent: '5.29%' },
            { symbol: 'DDC', name: 'Dick\'s Sporting Goods Inc.', price: 219.86, change: 1.57, changePercent: '0.72%' },
            { symbol: 'DFDV', name: 'Dimensional US Defensive Value ETF', price: 61.21, change: 0.16, changePercent: '0.26%' },
            { symbol: 'DFLI', name: 'Dragonfly Energy Holdings Corp.', price: 0.49, change: -0.01, changePercent: '-1.41%' },
            { symbol: 'DFSC', name: 'Defense Security Group Inc.', price: 2.1, change: 0, changePercent: '0.00%' },
            { symbol: 'DLMAF', name: 'Diamcor Mining Inc.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'DLTR', name: 'Dollar Tree Inc.', price: 110.1, change: 0.21, changePercent: '0.19%' },
            { symbol: 'DNA', name: 'Ginkgo Bioworks Holdings Inc.', price: 0.42, change: 0.01, changePercent: '1.45%' },
            { symbol: 'DRVN', name: 'DriveNxt Inc.', price: 12.38, change: -0.07, changePercent: '-0.56%' },
            { symbol: 'DYN', name: 'Dyne Therapeutics Inc.', price: 29.83, change: 0.74, changePercent: '2.55%' },
            { symbol: 'EDRY', name: 'Air T Inc.', price: 19.06, change: 0, changePercent: '0.00%' },
            { symbol: 'EFC', name: 'Ellington Financial Inc.', price: 11.9, change: 0.05, changePercent: '0.42%' },
            { symbol: 'EHAB', name: 'Enhabit Inc.', price: 8.41, change: 0.1, changePercent: '1.20%' },
            { symbol: 'EL', name: 'Estee Lauder Companies Inc.', price: 112.55, change: -0.01, changePercent: '-0.01%' },
            { symbol: 'ELF', name: 'e.l.f. Beauty Inc.', price: 129.89, change: 0.73, changePercent: '0.56%' },
            { symbol: 'ENB', name: 'Enbridge Inc.', price: 35.8, change: 0.25, changePercent: '0.70%' },
            { symbol: 'ENR', name: 'Energizer Holdings Inc.', price: 30.6, change: -0.15, changePercent: '-0.49%' },
            { symbol: 'EOLS', name: 'Evolus Inc.', price: 15.1, change: 0.2, changePercent: '1.34%' },
            { symbol: 'EQT', name: 'EQT Corporation', price: 38.64, change: 0.52, changePercent: '1.36%' },
            { symbol: 'ERNA', name: 'Eterna Therapeutics Inc.', price: 0.16, change: 0, changePercent: '0.00%' },
            { symbol: 'ESPR', name: 'Esperion Therapeutics Inc.', price: 2.29, change: 0.04, changePercent: '1.78%' },
            { symbol: 'ETNB', name: '89bio Inc.', price: 10.6, change: 0.35, changePercent: '3.41%' },
            { symbol: 'EXEL', name: 'Exelixis Inc.', price: 22.3, change: 0.13, changePercent: '0.59%' },
            { symbol: 'EXXRF', name: 'Excelerate Energy Inc.', price: 17.5, change: 0, changePercent: '0.00%' },
            { symbol: 'EYPT', name: 'EyePoint Pharmaceuticals Inc.', price: 21.05, change: 0.78, changePercent: '3.85%' },
            { symbol: 'FA', name: 'First Advantage Corp', price: 285.8, change: 1.01, changePercent: '0.35%' },
            { symbol: 'FAT', name: 'FAT Brands Inc.', price: 6.55, change: 0, changePercent: '0.00%' },
            { symbol: 'FATBP', name: 'FAT Brands Inc. Preferred', price: 4.8, change: 0, changePercent: '0.00%' },
            { symbol: 'FIG', name: 'Fortress Investment Group LLC', price: 8, change: 0, changePercent: '0.00%' },
            { symbol: 'FIZZ', name: 'National Beverage Corp.', price: 47.45, change: 0.05, changePercent: '0.11%' },
            { symbol: 'FMS', name: 'Fresenius Medical Care AG', price: 18.23, change: 0.06, changePercent: '0.33%' },
            { symbol: 'FOXX', name: 'Foxx Development Corp.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'FPI', name: 'Farmland Partners Inc.', price: 11.23, change: 0.02, changePercent: '0.18%' },
            { symbol: 'FVRR', name: 'Fiverr International Ltd.', price: 22.84, change: 0.16, changePercent: '0.71%' },
            { symbol: 'GALT', name: 'Galectin Therapeutics Inc.', price: 1.8, change: 0.04, changePercent: '2.27%' },
            { symbol: 'GB', name: 'Global Blue Group Holding AG', price: 5.4, change: 0.01, changePercent: '0.19%' },
            { symbol: 'GCT', name: 'GigaCloud Technology Inc.', price: 29.5, change: -0.19, changePercent: '-0.64%' },
            { symbol: 'GDRX', name: 'GoodRx Holdings Inc.', price: 8.01, change: -0.01, changePercent: '-0.12%' },
            { symbol: 'GETY', name: 'Getty Images Holdings Inc.', price: 3.16, change: 0.03, changePercent: '0.96%' },
            { symbol: 'GLAD', name: 'Gladstone Investment Corp.', price: 14.1, change: 0.01, changePercent: '0.07%' },
            { symbol: 'GLCNF', name: 'Glucotrack Inc.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'GLNCY', name: 'Glencore PLC', price: 11.83, change: 0.1, changePercent: '0.81%' },
            { symbol: 'GME', name: 'GameStop Corp.', price: 12.01, change: 0.1, changePercent: '0.84%' },
            { symbol: 'GNS', name: 'Genius Group Ltd.', price: 0.27, change: -0.01, changePercent: '-2.02%' },
            { symbol: 'GRAL', name: 'Crural Holdings Inc.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'HBI', name: 'Hanesbrands Inc.', price: 4.97, change: 0.02, changePercent: '0.40%' },
            { symbol: 'HIMS', name: 'Hims & Hers Health Inc.', price: 22.06, change: 0.49, changePercent: '2.27%' },
            { symbol: 'HLN', name: 'Haleon PLC', price: 8.29, change: -0.01, changePercent: '-0.12%' },
            { symbol: 'HOFV', name: 'Hall of Fame Resort & Entertainment Co.', price: 18.7, change: -0.2, changePercent: '-1.06%' },
            { symbol: 'HOLO', name: 'MicroCloud Hologram Inc.', price: 1.05, change: 0.03, changePercent: '2.94%' },
            { symbol: 'HOOD', name: 'Robinhood Markets Inc.', price: 11.23, change: 0.12, changePercent: '1.08%' },
            { symbol: 'HOTH', name: 'Hoth Therapeutics Inc.', price: 0.94, change: 0.01, changePercent: '1.07%' },
            { symbol: 'HRI', name: 'Herc Holdings Inc.', price: 140.23, change: 0.72, changePercent: '0.52%' },
            { symbol: 'HTGC', name: 'Hercules Capital Inc.', price: 20.08, change: 0.03, changePercent: '0.15%' },
            { symbol: 'HTZ', name: 'Hertz Global Holdings Inc.', price: 3.49, change: 0.05, changePercent: '1.45%' },
            { symbol: 'HUMA', name: 'Humacyte Inc.', price: 3.86, change: 0.2, changePercent: '5.46%' },
            { symbol: 'HUT', name: 'Hut 8 Mining Corp.', price: 12.75, change: 0.05, changePercent: '0.39%' },
            { symbol: 'HYPD', name: 'Hyperscale Data Inc.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'IDRSF', name: 'iDrilling Solutions Ltd.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'IMTX', name: 'Immuneering Corp.', price: 2.89, change: 0.1, changePercent: '3.58%' },
            { symbol: 'IMVT', name: 'Immunovant Inc.', price: 27.97, change: 1.01, changePercent: '3.75%' },
            { symbol: 'INCY', name: 'Incyte Corp.', price: 58.07, change: 0.58, changePercent: '1.01%' },
            { symbol: 'INGM', name: 'Ingermar Corp.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'INM', name: 'InMed Pharmaceuticals Inc.', price: 0.9, change: -0.01, changePercent: '-1.10%' },
            { symbol: 'INMB', name: 'INmune Bio Inc.', price: 10.39, change: 0.38, changePercent: '3.80%' },
            { symbol: 'INVZ', name: 'Innoviz Technologies Ltd.', price: 1.25, change: 0.02, changePercent: '1.63%' },
            { symbol: 'IONQ', name: 'IonQ Inc.', price: 7.21, change: 0.08, changePercent: '1.12%' },
            { symbol: 'IRD', name: 'Ireland Inc.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'ITOS', name: 'iTeos Therapeutics Inc.', price: 13.06, change: 0.32, changePercent: '2.51%' },
            { symbol: 'IVVD', name: 'Invivyd Inc.', price: 3.5, change: 0.12, changePercent: '3.55%' },
            { symbol: 'JD', name: 'JD.com Inc.', price: 28.53, change: -0.04, changePercent: '-0.14%' },
            { symbol: 'JFIN', name: 'Jindal Financial Inc.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'JOBY', name: 'Joby Aviation Inc.', price: 5.03, change: 0.01, changePercent: '0.20%' },
            { symbol: 'JSAIY', name: 'JD Sports Fashion PLC', price: 2.8, change: 0, changePercent: '0.00%' },
            { symbol: 'JTAI', name: 'JET.AI Inc.', price: 0.45, change: 0, changePercent: '0.00%' },
            { symbol: 'KAPA', name: 'KapStone Acquisition Corp.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'KHC', name: 'Kraft Heinz Co.', price: 33.51, change: 0.07, changePercent: '0.21%' },
            { symbol: 'KLG', name: 'WK Kellogg Co.', price: 18.23, change: -0.11, changePercent: '-0.60%' },
            { symbol: 'KNSA', name: 'Kiniksa Pharmaceuticals Ltd.', price: 15.6, change: 0.21, changePercent: '1.37%' },
            { symbol: 'KOSS', name: 'Koss Corp.', price: 4.54, change: 0.02, changePercent: '0.44%' },
            { symbol: 'KR', name: 'Kroger Co.', price: 51.52, change: -0.22, changePercent: '-0.42%' },
            { symbol: 'KROS', name: 'Keros Therapeutics Inc.', price: 55.48, change: 1.51, changePercent: '2.80%' },
            { symbol: 'KURA', name: 'Kura Oncology Inc.', price: 14.5, change: 0.28, changePercent: '1.97%' },
            { symbol: 'KVUE', name: 'Kenvue Inc.', price: 18.73, change: -0.1, changePercent: '-0.53%' },
            { symbol: 'KYMR', name: 'Kymera Therapeutics Inc.', price: 24.31, change: 0.53, changePercent: '2.23%' },
            { symbol: 'KYTX', name: 'Kyber Technologies Inc.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'KZIA', name: 'Kazia Therapeutics Ltd.', price: 0.21, change: 0, changePercent: '0.00%' },
            { symbol: 'LAC', name: 'Lithium Americas Corp.', price: 2.9, change: -0.01, changePercent: '-0.34%' },
            { symbol: 'LAES', name: 'SEALSQ Corp.', price: 1.02, change: -0.02, changePercent: '-1.92%' },
            { symbol: 'LAZR', name: 'Luminar Technologies Inc.', price: 1.48, change: 0.01, changePercent: '0.68%' },
            { symbol: 'LCID', name: 'Lucid Group Inc.', price: 2.52, change: -0.02, changePercent: '-0.79%' },
            { symbol: 'LCUT', name: 'Leatherback Ltd.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'LEAT', name: 'Leatt Corp.', price: 13.9, change: 0, changePercent: '0.00%' },
            { symbol: 'LINE', name: 'Lineage Inc.', price: 28.53, change: -0.04, changePercent: '-0.14%' },
            { symbol: 'LIPO', name: 'Lipella Pharmaceuticals Inc.', price: 0.5, change: 0.02, changePercent: '4.17%' },
            { symbol: 'LITB', name: 'Lifetime Brands Inc.', price: 1.25, change: -0.01, changePercent: '-0.79%' },
            { symbol: 'LKNCY', name: 'Lake Resources NL', price: 0.05, change: 0, changePercent: '0.00%' },
            { symbol: 'LMND', name: 'Lemonade Inc.', price: 10.05, change: 0.01, changePercent: '0.10%' },
            { symbol: 'LQDA', name: 'Liquidia Corp.', price: 13.58, change: 0.29, changePercent: '2.18%' },
            { symbol: 'LSF', name: 'Lakeshore Acquisition II Corp.', price: 11.45, change: 0, changePercent: '0.00%' },
            { symbol: 'LTH', name: 'Lifetime Brands Inc.', price: 7.7, change: -0.06, changePercent: '-0.77%' },
            { symbol: 'MAC', name: 'Macerich Co.', price: 14.88, change: -0.01, changePercent: '-0.07%' },
            { symbol: 'MAIN', name: 'Main Street Capital Corp.', price: 48.9, change: 0.02, changePercent: '0.04%' },
            { symbol: 'MARA', name: 'Marathon Digital Holdings Inc.', price: 19.5, change: 0.15, changePercent: '0.78%' },
            { symbol: 'MB', name: '51job Inc.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'MBRX', name: 'Moleculin Biotech Inc.', price: 0.4, change: 0.01, changePercent: '3.61%' },
            { symbol: 'MDWD', name: 'MediWound Ltd.', price: 11.5, change: 0.3, changePercent: '2.68%' },
            { symbol: 'MGX', name: 'Metalpha Technology Holding Ltd.', price: 1.15, change: 0.03, changePercent: '2.68%' },
            { symbol: 'MLGO', name: 'MicroAlgo Inc.', price: 2.1, change: -0.02, changePercent: '-0.94%' },
            { symbol: 'MNKD', name: 'MannKind Corp.', price: 4.09, change: 0.12, changePercent: '3.02%' },
            { symbol: 'MNST', name: 'Monster Beverage Corp.', price: 51.52, change: 0.19, changePercent: '0.37%' },
            { symbol: 'MO', name: 'Altria Group Inc.', price: 46.12, change: 0.12, changePercent: '0.26%' },
            { symbol: 'MSGE', name: 'Madison Square Garden Entertainment Corp.', price: 33.15, change: 0.01, changePercent: '0.03%' },
            { symbol: 'MYNZ', name: 'Minyzong Inc.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'MYSE', name: 'My Size Inc.', price: 1.6, change: 0, changePercent: '0.00%' },
            { symbol: 'NAKA', name: 'Nakamoto Holdings Inc.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'NBIS', name: 'Nebius Group NV', price: '--', change: '--', changePercent: '--' },
            { symbol: 'NERV', name: 'Minerva Neurosciences Inc.', price: 2.58, change: 0.03, changePercent: '1.18%' },
            { symbol: 'NEWT', name: 'NewtekOne Inc.', price: 14.2, change: 0.05, changePercent: '0.35%' },
            { symbol: 'NGENF', name: 'Negative Nugenics Inc.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'NIO', name: 'NIO Inc.', price: 4.4, change: 0.04, changePercent: '0.92%' },
            { symbol: 'NKTR', name: 'Nektar Therapeutics', price: 1.09, change: 0.02, changePercent: '1.87%' },
            { symbol: 'NNE', name: 'Nano Nuclear Energy Inc.', price: 19.3, change: 0.05, changePercent: '0.26%' },
            { symbol: 'NRXP', name: 'NRx Pharmaceuticals Inc.', price: 0.28, change: 0, changePercent: '0.36%' },
            { symbol: 'NTWK', name: 'NetTalk.com Inc.', price: 0, change: 0, changePercent: '0.00%' },
            { symbol: 'NU', name: 'Nu Holdings Ltd.', price: 12.01, change: 0.02, changePercent: '0.17%' },
            { symbol: 'NVAX', name: 'Novavax Inc.', price: 14.2, change: 0.06, changePercent: '0.42%' },
            { symbol: 'NVO', name: 'Novo Nordisk A/S', price: 139.77, change: 0.53, changePercent: '0.38%' },
            { symbol: 'NVST', name: 'Envista Holdings Corp.', price: 18.9, change: -0.02, changePercent: '-0.11%' },
            { symbol: 'NVTS', name: 'Navitas Semiconductor Corp.', price: 3.8, change: 0.03, changePercent: '0.80%' },
            { symbol: 'NWG', name: 'NatWest Group PLC', price: 8.2, change: 0.03, changePercent: '0.37%' },
            { symbol: 'OGN', name: 'Organon & Co.', price: 20.3, change: 0.03, changePercent: '0.15%' },
            { symbol: 'OKLO', name: 'Oklo Inc.', price: 3.7, change: 0.02, changePercent: '0.54%' },
            { symbol: 'OPHLY', name: 'Ophlyra Inc.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'OPY', name: 'Opportunity Financial LLC', price: 2.7, change: 0.01, changePercent: '0.37%' },
            { symbol: 'ORC', name: 'Orchid Island Capital Inc.', price: 8.2, change: 0.05, changePercent: '0.61%' },
            { symbol: 'ORMP', name: 'Oramed Pharmaceuticals Inc.', price: 2.65, change: 0.02, changePercent: '0.76%' },
            { symbol: 'OUST', name: 'Ouster Inc.', price: 9.2, change: -0.04, changePercent: '-0.43%' },
            { symbol: 'OVID', name: 'Ovid Therapeutics Inc.', price: 1.14, change: 0.01, changePercent: '0.88%' },
            { symbol: 'OXY', name: 'Occidental Petroleum Corp.', price: 63.4, change: 0.69, changePercent: '1.10%' },
            { symbol: 'PASG', name: 'Passage Bio Inc.', price: 0.64, change: 0.02, changePercent: '3.23%' },
            { symbol: 'PBH', name: 'Precision BioSciences Inc.', price: 11.23, change: 0.28, changePercent: '2.56%' },
            { symbol: 'PFE', name: 'Pfizer Inc.', price: 28.5, change: 0.1, changePercent: '0.35%' },
            { symbol: 'PGEN', name: 'Precigen Inc.', price: 1.34, change: 0.03, changePercent: '2.29%' },
            { symbol: 'PHAT', name: 'Phathom Pharmaceuticals Inc.', price: 10.3, change: 0.2, changePercent: '1.98%' },
            { symbol: 'PHIO', name: 'Phoenix Biotech Acquisition Corp.', price: 0.45, change: -0.01, changePercent: '-2.17%' },
            { symbol: 'PL', name: 'Planet Labs PBC', price: 2.15, change: 0.01, changePercent: '0.47%' },
            { symbol: 'PLTR', name: 'Palantir Technologies Inc.', price: 24.1, change: 0.05, changePercent: '0.21%' },
            { symbol: 'PODD', name: 'Insulet Corp.', price: 140.1, change: 2.15, changePercent: '1.56%' },
            { symbol: 'POWW', name: 'AMMO Inc.', price: 2.15, change: 0, changePercent: '0.00%' },
            { symbol: 'PRDSF', name: 'Prednisone Pharmaceuticals Inc.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'PROF', name: 'Profire Energy Inc.', price: 1.9, change: 0.02, changePercent: '1.06%' },
            { symbol: 'PSEC', name: 'Prospect Capital Corp.', price: 5.4, change: 0.01, changePercent: '0.19%' },
            { symbol: 'PSTV', name: 'Plus Therapeutics Inc.', price: 1.8, change: -0.02, changePercent: '-1.10%' },
            { symbol: 'PTON', name: 'Peloton Interactive Inc.', price: 3.5, change: -0.02, changePercent: '-0.57%' },
            { symbol: 'QBTS', name: 'D-Wave Quantum Inc.', price: 1.25, change: 0.01, changePercent: '0.81%' },
            { symbol: 'QMCO', name: 'Quantum Corp.', price: 0.5, change: 0.01, changePercent: '2.04%' },
            { symbol: 'QQQY', name: 'Defiance Nasdaq-100 Enhanced Options Income ETF', price: 17.5, change: 0.01, changePercent: '0.06%' },
            { symbol: 'QSI', name: 'Quantum BioPharma Ltd.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'QUBT', name: 'Quantum Computing Inc.', price: 0.65, change: 0.01, changePercent: '1.56%' },
            { symbol: 'RDY', name: 'Dr. Reddy\'s Laboratories Ltd.', price: 71.8, change: 0.21, changePercent: '0.29%' },
            { symbol: 'REKR', name: 'Rekor Systems Inc.', price: 1.7, change: 0.02, changePercent: '1.19%' },
            { symbol: 'RERE', name: 'Allied Gaming & Entertainment Inc.', price: 0.95, change: 0.03, changePercent: '2.84%' },
            { symbol: 'RGNX', name: 'REGENXBIO Inc.', price: 21.5, change: 0.45, changePercent: '2.14%' },
            { symbol: 'RGTI', name: 'Rigetti Computing Inc.', price: 1.05, change: 0.01, changePercent: '0.96%' },
            { symbol: 'RIOT', name: 'Riot Platforms Inc.', price: 9.5, change: 0.08, changePercent: '0.85%' },
            { symbol: 'RITM', name: 'Rithm Capital Corp.', price: 11.2, change: 0.04, changePercent: '0.36%' },
            { symbol: 'RIVN', name: 'Rivian Automotive Inc.', price: 11.1, change: -0.05, changePercent: '-0.45%' },
            { symbol: 'RKLB', name: 'Rocket Lab USA Inc.', price: 4.5, change: 0.02, changePercent: '0.45%' },
            { symbol: 'RKUNY', name: 'Rockwell Automation Inc.', price: 260.5, change: -1.5, changePercent: '-0.57%' },
            { symbol: 'ROIV', name: 'Roivant Sciences Ltd.', price: 11.1, change: 0.12, changePercent: '1.09%' },
            { symbol: 'ROKU', name: 'Roku Inc.', price: 56.5, change: 0.01, changePercent: '0.02%' },
            { symbol: 'RPRX', name: 'Royalty Pharma PLC', price: 27.5, change: 0.1, changePercent: '0.36%' },
            { symbol: 'RUM', name: 'Rumble Inc.', price: 6.5, change: 0.04, changePercent: '0.62%' },
            { symbol: 'RVPH', name: 'Reviva Pharmaceuticals Holdings Inc.', price: 3.5, change: 0.08, changePercent: '2.34%' },
            { symbol: 'SAGE', name: 'Sage Therapeutics Inc.', price: 10.5, change: 0.1, changePercent: '0.96%' },
            { symbol: 'SANA', name: 'Sana Biotechnology Inc.', price: 6.5, change: 0.15, changePercent: '2.36%' },
            { symbol: 'SBEV', name: 'Splash Beverage Group Inc.', price: 0.15, change: 0, changePercent: '0.00%' },
            { symbol: 'SBGI', name: 'Sinclair Inc.', price: 12.5, change: -0.05, changePercent: '-0.40%' },
            { symbol: 'SBH', name: 'Salem Media Group Inc.', price: 0.65, change: 0.01, changePercent: '1.56%' },
            { symbol: 'SBUX', name: 'Starbucks Corp.', price: 80.5, change: -0.5, changePercent: '-0.62%' },
            { symbol: 'SCS', name: 'Steelcase Inc.', price: 12.5, change: -0.05, changePercent: '-0.40%' },
            { symbol: 'SEPN', name: 'Septerna Inc.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'SERV', name: 'Serve Robotics Inc.', price: 2.5, change: -0.05, changePercent: '-1.96%' },
            { symbol: 'SGMO', name: 'Sangamo Therapeutics Inc.', price: 0.5, change: 0.01, changePercent: '2.04%' },
            { symbol: 'SHLS', name: 'Shoals Technologies Group Inc.', price: 7.5, change: -0.05, changePercent: '-0.66%' },
            { symbol: 'SIRI', name: 'Sirius XM Holdings Inc.', price: 2.75, change: -0.01, changePercent: '-0.36%' },
            { symbol: 'SJT', name: 'San Juan Basin Royalty Trust', price: 4.5, change: 0.05, changePercent: '1.12%' },
            { symbol: 'SKX', name: 'Skechers USA Inc.', price: 65.5, change: 0.5, changePercent: '0.77%' },
            { symbol: 'SLRX', name: 'Solera Holdings Inc.', price: 0.35, change: 0.01, changePercent: '2.94%' },
            { symbol: 'SMCI', name: 'Super Micro Computer Inc.', price: 850.5, change: 10.5, changePercent: '1.25%' },
            { symbol: 'SMR', name: 'NuScale Power Corp.', price: 7.5, change: 0.05, changePercent: '0.67%' },
            { symbol: 'SOFI', name: 'SoFi Technologies Inc.', price: 6.5, change: 0.05, changePercent: '0.78%' },
            { symbol: 'SOLV', name: 'Solvay SA', price: 32.5, change: 0.05, changePercent: '0.15%' },
            { symbol: 'SOUN', name: 'SoundHound AI Inc.', price: 3.8, change: 0.05, changePercent: '1.33%' },
            { symbol: 'SPHR', name: 'Spectrum Pharmaceuticals Inc.', price: 0.35, change: 0.01, changePercent: '2.94%' },
            { symbol: 'SRPT', name: 'Sarepta Therapeutics Inc.', price: 160.5, change: 2.5, changePercent: '1.58%' },
            { symbol: 'STEC', name: 'StealthGas Inc.', price: 4.5, change: 0.05, changePercent: '1.12%' },
            { symbol: 'STKL', name: 'Solid Biosciences Inc.', price: 7.5, change: 0.05, changePercent: '0.67%' },
            { symbol: 'STLA', name: 'Stellantis NV', price: 20.5, change: 0.05, changePercent: '0.24%' },
            { symbol: 'SWVL', name: 'Swvl Holdings Corp.', price: 5.5, change: 0.05, changePercent: '0.92%' },
            { symbol: 'SYTA', name: 'Siyata Mobile Inc.', price: 1.5, change: 0.05, changePercent: '3.45%' },
            { symbol: 'TAK', name: 'Takeda Pharmaceutical Co. Ltd.', price: 12.5, change: 0.05, changePercent: '0.40%' },
            { symbol: 'TALK', name: 'Talkspace Inc.', price: 2.5, change: 0.05, changePercent: '2.04%' },
            { symbol: 'TARS', name: 'Tarsus Pharmaceuticals Inc.', price: 15.5, change: 0.05, changePercent: '0.32%' },
            { symbol: 'TCEHY', name: 'Tencent Holdings Ltd.', price: 45.5, change: 0.05, changePercent: '0.11%' },
            { symbol: 'TCNNF', name: 'Trulieve Cannabis Corp.', price: 10.5, change: 0.05, changePercent: '0.48%' },
            { symbol: 'TCOM', name: 'Trip.com Group Ltd.', price: 45.5, change: 0.05, changePercent: '0.11%' },
            { symbol: 'TCPC', name: 'TCPCapital Inc.', price: 12.5, change: 0.05, changePercent: '0.40%' },
            { symbol: 'TECK', name: 'Teck Resources Ltd.', price: 45.5, change: 0.05, changePercent: '0.11%' },
            { symbol: 'TERN', name: 'Terns Pharmaceuticals Inc.', price: 5.5, change: 0.05, changePercent: '0.92%' },
            { symbol: 'TGT', name: 'Target Corp.', price: 145.5, change: 0.05, changePercent: '0.03%' },
            { symbol: 'TLRY', name: 'Tilray Brands Inc.', price: 1.8, change: 0.01, changePercent: '0.56%' },
            { symbol: 'TMDX', name: 'TransMedics Group Inc.', price: 105.5, change: 0.05, changePercent: '0.05%' },
            { symbol: 'TME', name: 'Tencent Music Entertainment Group', price: 15.5, change: 0.05, changePercent: '0.32%' },
            { symbol: 'TNXP', name: 'Tonix Pharmaceuticals Holding Corp.', price: 1.5, change: 0.05, changePercent: '3.45%' },
            { symbol: 'TOON', name: 'Toonami Inc.', price: 0.5, change: 0.01, changePercent: '2.04%' },
            { symbol: 'TPICQ', name: 'TPI Composites Inc. (Bankrupt)', price: 0.03, change: 0, changePercent: '0.00%' },
            { symbol: 'TSCDF', name: 'Tesla Inc. (OTC)', price: '--', change: '--', changePercent: '--' },
            { symbol: 'TSCDY', name: 'Tesco PLC', price: 7.5, change: 0.05, changePercent: '0.67%' },
            { symbol: 'TSCO', name: 'Tractor Supply Co.', price: 275.5, change: 0.05, changePercent: '0.02%' },
            { symbol: 'TYRA', name: 'Tyra Biosciences Inc.', price: 15.5, change: 0.05, changePercent: '0.32%' },
            { symbol: 'U', name: 'Unity Software Inc.', price: 15.5, change: 0.05, changePercent: '0.32%' },
            { symbol: 'UDMY', name: 'Udemy Inc.', price: 8.5, change: 0.05, changePercent: '0.59%' },
            { symbol: 'ULTA', name: 'Ultimate Products PLC', price: 385.5, change: 0.05, changePercent: '0.01%' },
            { symbol: 'UTHR', name: 'United Therapeutics Corp.', price: 265.5, change: 0.05, changePercent: '0.02%' },
            { symbol: 'VALE', name: 'Vale SA', price: 11.5, change: 0.05, changePercent: '0.44%' },
            { symbol: 'VCEL', name: 'Vericel Corp.', price: 35.5, change: 0.05, changePercent: '0.14%' },
            { symbol: 'VMAR', name: 'Vishay Precision Group Inc.', price: 28.5, change: 0.05, changePercent: '0.18%' },
            { symbol: 'VRNA', name: 'Verona Pharma plc', price: 14.5, change: 0.05, changePercent: '0.35%' },
            { symbol: 'VTRS', name: 'Viatris Inc.', price: 10.5, change: 0.05, changePercent: '0.48%' },
            { symbol: 'VVV', name: 'Valvoline Inc.', price: 38.5, change: 0.05, changePercent: '0.13%' },
            { symbol: 'WB', name: 'Warnermedia Inc.', price: 12.33, change: -0.06, changePercent: '-0.48%' },
            { symbol: 'WBA', name: 'Walgreens Boots Alliance Inc.', price: 11.98, change: 0.06, changePercent: '0.50%' },
            { symbol: 'WEED:CA', name: 'Canopy Growth Corp. (TSX)', price: 1.88, change: -0.04, changePercent: '-2.08%' },
            { symbol: 'WEN', name: 'Wendy\'s Co.', price: 9.21, change: 0.05, changePercent: '0.55%' },
            { symbol: 'WFC', name: 'Wells Fargo & Co.', price: 85.01, change: 0.69, changePercent: '0.82%' },
            { symbol: 'WGHTQ', name: 'Weight Watchers International Inc. (Bankrupt)', price: 0.307, change: 0, changePercent: '0.00%' },
            { symbol: 'WMB', name: 'Williams Companies Inc.', price: 64.01, change: 0.7, changePercent: '1.11%' },
            { symbol: 'WPP', name: 'WPP PLC', price: 48.5, change: 0.05, changePercent: '0.10%' },
            { symbol: 'WRD', name: 'WeRide Inc.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'XENE', name: 'Xenon Pharmaceuticals Inc.', price: 45.5, change: 0.05, changePercent: '0.11%' },
            { symbol: 'XERS', name: 'Xeris Biopharma Holdings Inc.', price: 2.5, change: 0.05, changePercent: '2.04%' },
            { symbol: 'XIFR', name: 'XPLR Infrastructure LP', price: 10.5, change: 0.05, changePercent: '0.48%' },
            { symbol: 'XRP-USD', name: 'XRP Cryptocurrency', price: 0.5, change: 0.01, changePercent: '2.04%' },
            { symbol: 'XXII', name: '22nd Century Group Inc.', price: 1.5, change: 0.05, changePercent: '3.45%' },
            { symbol: 'XYZ', name: 'Unknown Symbol', price: '--', change: '--', changePercent: '--' },
            { symbol: 'YI', name: '111 Inc.', price: 1.5, change: 0.05, changePercent: '3.45%' },
            { symbol: 'YMM', name: 'YieldMax MSTR Option Income Strategy ETF', price: 25.5, change: 0.05, changePercent: '0.20%' },
            { symbol: 'YSG', name: 'YieldMax Short NVDA Option Income Strategy ETF', price: 15.5, change: 0.05, changePercent: '0.32%' },
            { symbol: 'ZIM', name: 'ZIM Integrated Shipping Services Ltd.', price: 18.5, change: 0.05, changePercent: '0.27%' },
            { symbol: 'ZIP', name: 'Zip Co. Ltd.', price: 0.85, change: 0.01, changePercent: '1.19%' },
            { symbol: 'ZRSEF', name: 'Zarich International Corp.', price: '--', change: '--', changePercent: '--' },
            { symbol: 'ZVRA', name: 'Zevra Therapeutics Inc.', price: 4.5, change: 0.05, changePercent: '1.12%' },
            { symbol: 'ZVSA', name: 'Zevia Inc.', price: 0.75, change: 0.01, changePercent: '1.35%' },
            { symbol: 'ZYME', name: 'Zymeworks Inc.', price: 8.5, change: 0.05, changePercent: '0.59%' }
        ];

        let filteredStocks = [];
        let sortColumn = 'symbol';
        let sortDirection = 'asc';
        let scrollY = 0;
        let scrollX = 0;
        
        // --- Touch handling variables ---
        let isDragging = false;
        let lastTouchX = 0;
        let lastTouchY = 0;
        
        const rowHeight = 40;
        const headerHeight = 50;

        // Switched to fixed widths for columns to enable horizontal scrolling
        const columns = [
            { name: 'Symbol', width: 120, key: 'symbol', align: 'left' },
            { name: 'Name', width: 280, key: 'name', align: 'left' },
            { name: 'Price', width: 100, key: 'price', align: 'center' },
            { name: 'Change', width: 100, key: 'change', align: 'center' },
            { name: '% Change', width: 100, key: 'changePercent', align: 'center' }
        ];
        const totalContentWidth = columns.reduce((sum, col) => sum + col.width, 0);


        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            // Clamp scroll positions on resize
            clampScroll();
            draw();
        }

        function clampScroll() {
            const maxScrollY = Math.max(0, filteredStocks.length * rowHeight - canvas.height + headerHeight);
            scrollY = Math.max(0, Math.min(scrollY, maxScrollY));

            const maxScrollX = Math.max(0, totalContentWidth - canvas.width);
            scrollX = Math.max(0, Math.min(scrollX, maxScrollX));
        }

        function filterAndSort() {
            const searchTerm = searchInput.value.toLowerCase();
            filteredStocks = stocks.filter(stock =>
                stock.symbol.toLowerCase().includes(searchTerm) ||
                stock.name.toLowerCase().includes(searchTerm)
            );

            filteredStocks.sort((a, b) => {
                let valA = a[sortColumn];
                let valB = b[sortColumn];

                if(sortColumn === 'price' || sortColumn === 'change') {
                    valA = (typeof valA === 'number') ? valA : -Infinity;
                    valB = (typeof valB === 'number') ? valB : -Infinity;
                }

                let comparison = 0;
                if (valA > valB) {
                    comparison = 1;
                } else if (valA < valB) {
                    comparison = -1;
                }
                return sortDirection === 'asc' ? comparison : comparison * -1;
            });

            scrollY = 0;
            scrollX = 0;
            draw();
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawHeader();
            drawRows();

            // Draw a subtle hint for horizontal scrolling on mobile
            if (totalContentWidth > canvas.width) {
                 ctx.fillStyle = 'rgba(0, 0, 0, 0.4)';
                 ctx.font = '12px Inter';
                 ctx.textAlign = 'right';
                 ctx.fillText('scroll for more →', canvas.width - 10, canvas.height - 10);
            }
        }
        
        function drawHeader() {
            ctx.fillStyle = '#374151'; // gray-700
            ctx.fillRect(0, 0, canvas.width, headerHeight);

            ctx.font = 'bold 14px Inter';
            ctx.fillStyle = 'white';
            ctx.textBaseline = 'middle';

            let x = -scrollX;
            columns.forEach(col => {
                const colWidth = col.width;
                let text = col.name;
                if (col.key === sortColumn) {
                    text += sortDirection === 'asc' ? ' ▲' : ' ▼';
                }
                
                ctx.textAlign = col.align;
                let textX = (col.align === 'left') ? x + 10 : x + colWidth / 2;
                
                ctx.fillText(text, textX, headerHeight / 2);
                x += colWidth;
            });
        }
        
        function drawRows() {
            const startIndex = Math.floor(scrollY / rowHeight);
            const endIndex = Math.min(startIndex + Math.ceil(canvas.height / rowHeight) + 1, filteredStocks.length);

            for (let i = startIndex; i < endIndex; i++) {
                const stock = filteredStocks[i];
                if (!stock) continue;
                const y = headerHeight + i * rowHeight - scrollY;

                ctx.fillStyle = i % 2 === 0 ? '#F9FAFB' : 'white'; // gray-50
                ctx.fillRect(0, y, canvas.width, rowHeight);
                
                let x = -scrollX;
                columns.forEach(col => {
                    const colWidth = col.width;
                    ctx.textAlign = col.align;
                    let textX = (col.align === 'left') ? x + 10 : x + colWidth / 2;
                    
                    let value = stock[col.key];
                    let color = '#111827'; // Default text color
                    let font = '14px Inter';
                    
                    if (col.key === 'symbol') {
                         font = '500 14px Inter';
                         color = '#3B82F6'; // blue-500 for link
                    }
                    if(col.key === 'price') font = '500 14px Inter';

                    if (typeof value === 'number') {
                         if(col.key === 'change') {
                            color = value >= 0 ? '#10B981' : '#EF4444';
                         }
                         value = value.toFixed(2);
                    } else if (col.key === 'changePercent' && typeof stock.change === 'number') {
                         color = stock.change >= 0 ? '#10B981' : '#EF4444';
                    }
                    
                    ctx.font = font;
                    ctx.fillStyle = color;
                    ctx.fillText(String(value), textX, y + rowHeight / 2);

                    if (col.key === 'symbol' && value !== '--') {
                        ctx.beginPath();
                        ctx.moveTo(textX, y + rowHeight / 2 + 8);
                        ctx.lineTo(textX + ctx.measureText(String(value)).width, y + rowHeight / 2 + 8);
                        ctx.strokeStyle = color;
                        ctx.lineWidth = 1;
                        ctx.stroke();
                    }

                    x += colWidth;
                });
            }
        }

        // --- Event Listeners ---
        window.addEventListener('resize', resizeCanvas);
        searchInput.addEventListener('input', filterAndSort);

        canvas.addEventListener('wheel', e => {
            e.preventDefault();
            scrollY += e.deltaY;
            clampScroll();
            draw();
        });

        canvas.addEventListener('click', e => {
            if (isDragging) { // Don't register clicks if it was a drag
                isDragging = false;
                return;
            }
            const rect = canvas.getBoundingClientRect();
            const y = e.clientY - rect.top;
            const x = e.clientX - rect.left;
            
            if (y <= headerHeight) { // Header click for sorting
                const virtualX = x + scrollX;
                let currentX = 0;
                for(const col of columns) {
                    if(virtualX >= currentX && virtualX <= currentX + col.width) {
                        if (sortColumn === col.key) {
                            sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
                        } else {
                            sortColumn = col.key;
                            sortDirection = 'asc';
                        }
                        filterAndSort();
                        break;
                    }
                    currentX += col.width;
                }
            } else { // Row click for hyperlink
                const virtualX = x + scrollX;
                if (virtualX <= columns[0].width) {
                     const rowIndex = Math.floor((scrollY + y - headerHeight) / rowHeight);
                     const stock = filteredStocks[rowIndex];
                     if(stock) {
                        const url = `https://www.google.com/search?q=${stock.symbol} stock`;
                        window.open(url, '_blank');
                     }
                }
            }
        });
        
        // --- Touch Listeners for mobile scrolling ---
        canvas.addEventListener('touchstart', e => {
            isDragging = false; // Reset on new touch
            lastTouchX = e.touches[0].clientX;
            lastTouchY = e.touches[0].clientY;
        });

        canvas.addEventListener('touchmove', e => {
            e.preventDefault(); // Prevents browser from scrolling page
            isDragging = true;
            const touchX = e.touches[0].clientX;
            const touchY = e.touches[0].clientY;
            
            const deltaX = touchX - lastTouchX;
            const deltaY = touchY - lastTouchY;
            
            scrollX -= deltaX;
            scrollY -= deltaY;

            clampScroll();
            draw();
            
            lastTouchX = touchX;
            lastTouchY = touchY;
        });


        // Initial setup
        filterAndSort();
        resizeCanvas();
        (() => {
            const now = new Date();
            lastUpdatedContainer.textContent = `Prices based on file from: ${now.toLocaleDateString()}`;
        })();
        draw(); 
    });
    </script>
</body>
</html>

